<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Finance Dashboard</title>
    <style>
      :root{
        --bg:#ffffff;
        --text:#0f172a;
        --muted:#64748b;
        --border:#e5e7eb;
        --card:#ffffff;
        --shadow: 0 10px 25px rgba(2,6,23,.06);
        --radius:14px;
      }
      *{box-sizing:border-box}
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
        color:var(--text);
        background:var(--bg);
      }
      body.auth-only{
        min-height:100vh;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      body.auth-only .wrap{width:100%}
      body.auth-only #auth{margin:0 auto}
      a{color:inherit; text-decoration:none}
      .wrap{max-width:1040px; margin:0 auto; padding:28px 22px 60px;}
      /* top nav */
      .topbar{
        display:flex; align-items:center; justify-content:center;
        gap:26px; color:var(--muted);
        font-size:14px;
        margin-top:8px;
      }
      .topbar a{padding:6px 8px; border-radius:10px}
      .topbar a.active{color:var(--text); font-weight:600}
      /* header row */
      .header{
        display:flex; align-items:center; justify-content:space-between;
        margin:40px 0 18px;
      }
      .back{
        font-size:14px; color:var(--muted); font-weight:600;
      }
      .kebab{
        width:36px; height:36px; border:1px solid var(--border);
        border-radius:999px; display:grid; place-items:center;
        background:#fff;
      }
      .kebab span{letter-spacing:2px; transform:translateY(-1px)}
      /* main grid */
      .grid{
        display:grid;
        grid-template-columns: 330px 1fr;
        gap:16px;
        align-items:stretch;
      }

      .bankcard{
        border-radius:18px;
        padding:18px 18px;
        color:#eef2ff;
        min-height:150px;
        box-shadow: var(--shadow);
        border:1px solid rgba(255,255,255,.18);
        background:
          radial-gradient(1100px 500px at 30% 120%, rgba(37,99,235,.85), transparent 60%),
          radial-gradient(700px 400px at 85% 20%, rgba(16,185,129,.55), transparent 60%),
          linear-gradient(135deg, rgba(15,23,42,.70), rgba(15,23,42,.35));
        position:relative;
        overflow:hidden;
      }
      .bankcard .name{font-size:12px; opacity:.95}
      .bankcard .iban{font-size:12px; opacity:.85; margin-top:2px}
      .rings{
        position:absolute; right:18px; bottom:16px;
        width:92px; height:56px;
      }
      .rings:before, .rings:after{
        content:""; position:absolute; width:48px; height:48px;
        border:1.8px solid rgba(255,255,255,.65);
        border-radius:999px; top:6px;
      }
      .rings:before{left:10px}
      .rings:after{left:36px}

      .stats{
        display:grid;
        grid-template-columns: repeat(3, 1fr);
        grid-auto-rows:minmax(84px, auto);
        gap:12px;
      }
      .stat{
        background:var(--card);
        border:1px solid var(--border);
        border-radius:12px;
        padding:12px 12px;
        box-shadow: 0 6px 18px rgba(2,6,23,.04);
      }
      .stat .label{font-size:12px; color:var(--muted); font-weight:600}
      .stat .value{font-size:22px; font-weight:800; margin-top:6px}
      .stat .hint{font-size:11px; color:var(--muted); margin-top:6px}
      .stat.tall{
        grid-row: span 2;
      }

      /* payments */
      h2{
        margin:26px 0 10px;
        font-size:18px;
      }
      .payments{
        border:1px solid var(--border);
        border-radius:14px;
        overflow:hidden;
        background:#fff;
        box-shadow: 0 6px 18px rgba(2,6,23,.04);
      }
      .row{
        display:grid;
        grid-template-columns: 44px 1fr 120px;
        align-items:center;
        gap:12px;
        padding:12px 14px;
        border-top:1px solid var(--border);
      }
      .row:first-child{border-top:none}
      .icon{
        width:34px; height:34px;
        border-radius:10px;
        display:grid; place-items:center;
        font-weight:700;
        border:1px solid var(--border);
        background:#fff;
      }
      .titleline{
        display:flex; align-items:baseline; gap:8px;
      }
      .title{font-weight:700; font-size:13px}
      .sub{font-size:12px; color:var(--muted)}
      .tag{
        display:inline-block;
        font-size:11px;
        padding:2px 7px;
        border:1px solid var(--border);
        color:var(--muted);
        border-radius:999px;
        margin-top:5px;
        width:max-content;
      }
      .amount{
        text-align:right;
      }
      .amount .euro{font-weight:800}
      .amount .when{font-size:12px; color:var(--muted); margin-top:4px}

      /* responsive */
      @media (max-width: 860px){
        .grid{grid-template-columns:1fr}
        .stats{grid-template-columns: repeat(2, 1fr)}
        .stat.tall{grid-row: auto}
      }
      @media (max-width: 520px){
        .stats{grid-template-columns:1fr}
        .row{grid-template-columns: 44px 1fr 96px}
      }
      /* iOS Safari fix voor knoppen */
button {
  appearance: none;
  -webkit-appearance: none;
  font-size: 16px; /* cruciaal voor iPhone */
  line-height: 1.2;
  color: #0f172a;
}
    </style>
  </head>

  <body>
    <div class="wrap">
            <section id="auth" style="max-width:420px; margin:0 auto 18px; border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow: 0 6px 18px rgba(2,6,23,.04);">
        <h2 style="margin:0 0 10px; font-size:16px;">Inloggen</h2>

        <form id="loginForm" style="display:grid; gap:10px;">
          <label style="display:grid; gap:6px; font-size:12px; color:var(--muted);">
            E-mail
            <input id="email" type="email" required style="padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-size:14px;">
          </label>

          <label style="display:grid; gap:6px; font-size:12px; color:var(--muted);">
            Wachtwoord
            <input id="password" type="password" required minlength="8" style="padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-size:14px;">
          </label>

          <button type="submit" style="padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-weight:700; background:#fff; cursor:pointer;">
            Log in
          </button>

          <button id="signupBtn" type="button" style="padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-weight:700; background:#fff; cursor:pointer;">
            Account maken
          </button>

          <button id="logoutBtn" type="button" style="padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-weight:700; background:#fff; cursor:pointer; display:none;">
            Uitloggen
          </button>

          <div id="authMsg" style="font-size:12px; color:var(--muted);"></div>
        </form>
      </section>

      <div id="app" style="display:none;">
        <nav class="topbar" aria-label="Primary">
          <a class="active" href="#">melkic</a>
          <a href="#">finance</a>
        </nav>

        <div class="header">
          <a class="back" href="#">Back to home</a>
          <button class="kebab" aria-label="Menu">
            <span>¬∑¬∑¬∑</span>
          </button>
        </div>

        <section class="grid" aria-label="Overview">
          <div class="bankcard">
            <div class="name">John Doe</div>
            <div class="iban">NL03 INGB 8286 5326 33</div>
            <div class="rings" aria-hidden="true"></div>
          </div>

          <div class="stats">
            <div class="stat">
              <div class="label">Personal Balance</div>
              <div class="value">‚Ç¨575.00</div>
              <div class="hint">Salary in 12 days</div>
            </div>

            <div class="stat">
              <div class="label">Bills</div>
              <div class="value">‚Ç¨1175.00</div>
              <div class="hint">Salary in 12 days</div>
            </div>

            <div class="stat tall">
              <div class="label">Other Data</div>
              <div class="value">‚Ç¨525.00</div>
              <div class="hint">Salary in 12 days</div>
            </div>

            <div class="stat">
              <div class="label">Savings</div>
              <div class="value">‚Ç¨300.00</div>
              <div class="hint">Salary in 12 days</div>
            </div>

            <div class="stat">
              <div class="label">Groceries &amp; Gas</div>
              <div class="value">‚Ç¨525.00</div>
              <div class="hint">Salary in 12 days</div>
            </div>
          </div>
        </section>

        <h2>Upcoming Payments</h2>
        <section class="payments" aria-label="Upcoming payments list">
          <div class="row">
            <div class="icon" title="Spotify">üü¢</div>
            <div>
              <div class="titleline">
                <div class="title">Spotify</div>
                <div class="sub">Paypal</div>
              </div>
              <div class="tag">Emma</div>
            </div>
            <div class="amount">
              <div class="euro">‚Ç¨18.00</div>
              <div class="when">In 3 Days</div>
            </div>
          </div>

          <div class="row">
            <div class="icon" title="Internet">üåê</div>
            <div>
              <div class="titleline">
                <div class="title">Internet Thuis</div>
                <div class="sub">KPN</div>
              </div>
              <div class="tag">Gezamenlijk</div>
            </div>
            <div class="amount">
              <div class="euro">‚Ç¨18.00</div>
              <div class="when">In 4 Days</div>
            </div>
          </div>

          <div class="row">
            <div class="icon" title="Splice">üéöÔ∏è</div>
            <div>
              <div class="titleline">
                <div class="title">Splice</div>
                <div class="sub">Paypal Gezamenlijk</div>
              </div>
              <div class="tag">Hamza</div>
            </div>
            <div class="amount">
              <div class="euro">‚Ç¨18.00</div>
              <div class="when">In 10 Days</div>
            </div>
          </div>

          <div class="row">
            <div class="icon" title="OneDrive">‚òÅÔ∏è</div>
            <div>
              <div class="titleline">
                <div class="title">OneDrive</div>
                <div class="sub">iDeal</div>
              </div>
              <div class="tag">Hamza</div>
            </div>
            <div class="amount">
              <div class="euro">‚Ç¨18.00</div>
              <div class="when">In 10 Days</div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script>
      // 1) Supabase koppeling
      const supabaseUrl = "https://cgeescjioqfmjfgdtlnm.supabase.co";
      const supabaseKey = "sb_publishable_lXmIiIiDriKmapEhhRzCFw_oi6rLdxR";
      const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

      // 2) Menu knop (optioneel)
      const kebab = document.querySelector(".kebab");
      if (kebab) {
        kebab.addEventListener("click", () => alert("Menu (later)"));
      }

      // 3) Login UI refs
      const app = document.getElementById("app");
      const loginForm = document.getElementById("loginForm");
      const signupBtn = document.getElementById("signupBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const authMsg = document.getElementById("authMsg");

      function setMsg(text) {
        if (authMsg) authMsg.textContent = text || "";
      }

      function withTimeout(promise, ms, label) {
        let timerId;
        const timeout = new Promise((_, reject) => {
          timerId = setTimeout(() => {
            reject(new Error(`${label} timeout na ${ms}ms`));
          }, ms);
        });

        return Promise.race([promise, timeout]).finally(() => clearTimeout(timerId));
      }

      async function refreshUI() {
        try {
          const { data } = await supabaseClient.auth.getSession();
          const loggedIn = !!data.session;

          if (app) app.style.display = loggedIn ? "" : "none";
          if (logoutBtn) logoutBtn.style.display = loggedIn ? "" : "none";
          if (signupBtn) signupBtn.style.display = loggedIn ? "none" : "";
          setMsg(loggedIn ? "Je bent ingelogd." : "Log in om verder te gaan.");
        } catch (err) {
          console.error("refreshUI error:", err);
          setMsg("Er ging iets mis bij het ophalen van je sessie.");
        }
      }

      // Safety check
      if (!loginForm || !signupBtn) {
        setMsg("Login UI niet gevonden. Check of loginForm en signupBtn bestaan in HTML.");
      } else {
        // Login submit
        loginForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          setMsg("Bezig met inloggen...");

          const email = document.getElementById("email")?.value?.trim();
          const password = document.getElementById("password")?.value;

          try {
            const { data, error } = await withTimeout(
              supabaseClient.auth.signInWithPassword({ email, password }),
              12000,
              "Login"
            );
            console.log("login response:", data, error);
            if (error) return setMsg("Inloggen mislukt: " + error.message);
          } catch (err) {
            console.error("login error:", err);
            return setMsg("Inloggen mislukt: " + err.message);
          }

          setMsg("Ingelogd.");
          await refreshUI();
        });

        // Signup
        signupBtn.addEventListener("click", async () => {
          setMsg("Account aanmaken...");

          const email = document.getElementById("email")?.value?.trim();
          const password = document.getElementById("password")?.value;

          try {
            const { data, error } = await withTimeout(
              supabaseClient.auth.signUp({ email, password }),
              12000,
              "Signup"
            );
            console.log("signup response:", data, error);
            if (error) return setMsg("Account maken mislukt: " + error.message);
          } catch (err) {
            console.error("signup error:", err);
            return setMsg("Account maken mislukt: " + err.message);
          }

          setMsg("Account gemaakt. Kijk in je mail als er bevestiging nodig is, of probeer te loggen.");
          await refreshUI();
        });

        // Logout
        if (logoutBtn) {
          logoutBtn.addEventListener("click", async () => {
            await supabaseClient.auth.signOut();
            setMsg("Uitgelogd.");
            await refreshUI();
          });
        }
      }

      // Update UI when auth changes
      supabaseClient.auth.onAuthStateChange(() => refreshUI());
      refreshUI();
    </script>
